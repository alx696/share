<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Go WebAssembly 简单例子</title>
  <script src="wasm_exec.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      /**
       * 初始化UI
       */
      let initUi = () => {
        let form = document.getElementById('form');
        let inputName = form.querySelector('input');
        let buttonHi = form.querySelector('button');

        form.addEventListener('submit', evt => {
          evt.preventDefault();

          let name = inputName.value;
          GOhi(name, (txt) => {
            alert(txt);
          });
        });
        buttonHi.textContent = '获取问候';
        buttonHi.removeAttribute('disabled');
      };

      //加载,编译,执行wasm模块
      const GO = new Go();
      WebAssembly.instantiateStreaming(
          fetch("simple.wasm"),
          GO.importObject
      ).then((result) => {
        GO.run(result.instance);

        initUi();
      });
    });
  </script>
</head>
<body>
<form id="form">
  <h1>输入你的名字,获取来自go的问候</h1>
  <p>
    <input required placeholder="输入你的名字" autofocus>
    <button disabled>等待wasm模块完成实例化...</button>
  </p>
</form>
</body>
</html>